# Лабораторная работа №4
```
Тема: Проектирование REST API
Цель работы: Получить опыт проектирования программного интерфейса.

Для выбранного сервиса системы, предоставляющего API:
Зафиксировать принятые проектные решения (не менее 8) при проектировании API (оформить в виде документации с четким и подробным описанием в виде документа в md-формате). Использовать методы: GET, POST, PUT, DELETE.
(4 балла)
Реализовать соответствующий API (c методами GET, POST). Количество методов не менее 6.
(2 балла)
Протестировать API при помощи Postman (дополнить отчетный документ из п.1 результатами тестирования, сопроводив принтскринами из Postman). Минимум 2 теста на каждый Endpoint.
(2 балла)
Повышенная сложность: Реализовать и протестировать API c методами PUT, DELETE. (2 балла)
```
---

## Проектные решения
### 1. Использование FastAPI
FastAPI позволяет быстро разрабатывать REST API с автоматической валидацией данных и поддержкой OpenAPI.

### 2. Использование PostgreSQL в качестве хранилища
Выбор PostgreSQL обусловлен его надежностью и возможностью работы с реляционными данными.

### 3. Применение SQLAlchemy
SQLAlchemy обеспечивает удобную ORM для работы с БД, снижая сложность написания SQL-запросов.

### 4. Логирование запросов
Для отладки и мониторинга запросов используется middleware для логирования входящих API-запросов.

### 5. Разделение кода по уровням
Проект структурирован по принципу разделения ответственности (SoC):
- **models/** – схемы базы данных.
- **api/** – обработчики API-запросов.
- **services/** – бизнес-логика.
- **tests/** – тесты API.

### 6. Реализация CRUD для пользователей
API `/user` реализует полный набор CRUD-операций для управления пользователями.

### 7. Пагинация при получении списка пользователей
В `GET /user/` добавлены параметры `offset` и `limit` для удобной работы с большими объемами данных.

### 8. Создание отдельных контроллеров
Для удобства API разделено на отдельные контроллеры:
- `/user` – управление пользователями.
- `/completions` – генерация кода.
- `/chat_completions` – чат-комплит API.
- `/health` – проверка работоспособности сервиса.

---

## Реализованные API-методы

### 1. **Регистрация пользователя**
**Метод:** `POST /user/`
- **Описание:** Создает нового пользователя.
- **Тело запроса:**
  ```json
  {
    "email": "user@example.com",
    "login": "user1",
    "password": "password123"
  }
  ```
- **Ответ:**
  ```json
  {
    "guid": "123e4567-e89b-12d3-a456-426614174000",
    "email": "user@example.com",
    "login": "user1",
    "created_at": "2024-03-10T12:00:00Z"
  }
  ```

### 2. **Авторизация и получение токена**
**Метод:** `POST /token`
- **Описание:** Получает `access_token` и `refresh_token` для аутентификации.
- **Тело запроса:**
  ```json
  {
    "username": "user1",
    "password": "password123"
  }
  ```
- **Ответ:**
  ```json
  {
    "access_token": "eyJhbGciOiJIUzI1...",
    "refresh_token": "eyJhbGciOiJIUzI1...",
    "token_type": "bearer"
  }
  ```

### 3. **Получение списка пользователей**
**Метод:** `GET /user/`
- **Описание:** Возвращает список пользователей с поддержкой пагинации.
- **Параметры запроса:**
    - `offset`: Начало списка (по умолчанию `0`)
    - `limit`: Количество пользователей (по умолчанию `100`)
- **Ответ:**
  ```json
  [
    {
      "guid": "123e4567-e89b-12d3-a456-426614174000",
      "email": "user@example.com",
      "login": "user1",
      "created_at": "2024-03-10T12:00:00Z"
    }
  ]
  ```

### 4. **Обновление данных пользователя**
**Метод:** `PUT /user/{user_guid}`
- **Описание:** Обновляет информацию о пользователе.
- **Тело запроса:**
  ```json
  {
    "email": "newemail@example.com",
    "login": "newuser1"
  }
  ```
- **Ответ:**
  ```json
  {
    "guid": "123e4567-e89b-12d3-a456-426614174000",
    "email": "newemail@example.com",
    "login": "newuser1",
    "updated_at": "2024-03-10T12:10:00Z"
  }
  ```

### 5. **Удаление пользователя**
**Метод:** `DELETE /user/{user_guid}`
- **Описание:** Удаляет пользователя по его `guid`.
- **Ответ:**
  ```json
  {
    "message": "User deleted successfully"
  }
  ```

### 6. **Проверка работоспособности API**
**Метод:** `GET /health`
- **Описание:** Проверяет работоспособность зависимостей сервиса.
- **Ответ:**
  ```json
  {
    "status": "ok"
  }
  ```

---

## Тестирование API в Postman
Для тестирования API использовался **Postman**. В ходе тестирования были проведены следующие проверки:
- Регистрация нового пользователя.
- Авторизация и получение токенов.
- Запрос списка пользователей.
- Обновление данных пользователя.
- Удаление пользователя.
- Проверка работы `/health`.

---